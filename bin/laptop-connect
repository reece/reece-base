#!/bin/sh

PATH="$(dirname "$0")":$PATH

external_display_present() {
	[ "$(disper -l | grep ^display | wc -l)" -gt 1 ]
}

case "$1" in
	c*)
		echo "$(basename "$0")" connect
		cl-wrapper laptop-mode e
		nvidia-settings &
		;;
	d*)
		echo "$(basename "$0")" disconnect
		cl-wrapper laptop-mode l
		disper -s
		;;
	g*)							# guess
		echo "$(basename "$0")" guess
		cl-wrapper laptop-mode guess
		if external_display_present; then
			# ideally we'd have a display-model-dependent handling here
			# unfortunately, disper doesn't handle the case of cloned displays
			# with different resultions yet, so we fall back to manual config with 
			# nvidia-settings
			nvidia-settings &
		else
			disper -s
		fi
		;;
	*) 
		echo "$0: unrecognized argument" 1>&2
		exit 1
		;;
esac
